# Position Management Service

Event-Sourced Position Management Service with Hotpath/Coldpath Architecture.

## Architecture

- **Domain Layer**: Core business models and abstractions
- **Infrastructure Layer**: Database, messaging, and caching implementations
- **Application Layer**: Business logic and orchestration
- **API Layer**: REST endpoints and Spring Boot application

## Key Features

### 1. Messaging Abstraction
- **Interface**: `MessageProducer` and `MessageConsumer` in domain layer
- **Implementations**:
  - Kafka (`KafkaMessageProducer`, `KafkaMessageConsumer`)
  - Solace (`SolaceMessageProducer`, `SolaceMessageConsumer`)
- **Configuration**: Set `app.messaging.provider=kafka` or `solace` in `application.yml`

### 2. Caching Abstraction
- **Interface**: `CacheService` in domain layer
- **Implementations**:
  - Redis (`RedisCacheService`)
  - In-Memory (`MemoryCacheService`)
- **Configuration**: Set `app.cache.provider=redis` or `memory` in `application.yml`

### 3. Database
- **SQL Server** configured with Flyway migrations
- Connection pooling via HikariCP
- Migrations in `infrastructure/src/main/resources/db/migration/sqlserver/`

## Project Structure

```
position-management-service/
├── domain/          # Core domain models and abstractions
├── infrastructure/  # Database, messaging, caching implementations
├── application/     # Business logic and services
└── api/            # REST API and Spring Boot app
```

## Getting Started

### Prerequisites
- Java 17+
- Maven 3.8+
- Docker and Docker Compose

### Start Infrastructure

```bash
docker-compose up -d
```

This starts:
- SQL Server (port 1433)
- Kafka (port 9092)
- Zookeeper (port 2181)
- Redis (port 6379)

### Configuration

Set environment variables or update `application.yml`:

```bash
export DB_HOST=localhost
export DB_PORT=1433
export DB_NAME=equity_swap_db
export DB_USERNAME=SA
export DB_PASSWORD=Test@123456

# Optional: Switch messaging provider
export MESSAGING_PROVIDER=kafka  # or solace

# Optional: Switch cache provider
export CACHE_PROVIDER=redis  # or memory
```

### Build and Run

```bash
mvn clean install
mvn spring-boot:run -pl api
```

## Next Steps

1. Implement application services (EventStoreService, PositionService)
2. Create REST API controllers
3. Add business logic for position management
4. Implement event sourcing patterns

## Design Principles

- **Abstraction**: Domain layer defines interfaces, infrastructure provides implementations
- **Swappable**: Easily switch between Kafka/Solace, Redis/Memory via configuration
- **Clean Architecture**: Clear separation of concerns across layers
